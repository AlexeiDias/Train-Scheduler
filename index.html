<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- Firebase References -->
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
  <!-- Link to Moment.js should go here -->
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

  <title>Train Scheduler</title>
</head>

<body>
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
      <div class="jumbotron jumbotron-fluid">
        <div class="container text-center">
          <h1 class="display-4">Anytime is a Train Time</h1>
          <a href="https://momentjs.com/docs/#/get-set/" target='_blank'></a>
            <h3>Current Time: <span id="time"></span></h3>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
      <div class="card">
        <div class="card-header">
          Current Train Schedulle

        </div>
        <div class="card-body">
          <table class="table table-sm table-hover" id='employee-table'>
            <thead>
              <tr>
                <th scope="col">Train Name</th>
                <th scope="col">Destination</th>
                <th scope="col">Frequency (min)</th>
                <th scope="col">Next Arrival</th>
                <th scope="col">Minutes Away</th>
              </tr>
            </thead>
            <tbody>
            </tbody>
          </table>

        </div>
      </div>
    </div>
    <div class="col-sm-2"></div>
  </div>
  <br>
  <div class="row">
    <div class="col-sm-2"></div>
    <div class="col-sm-8">
      <div class="card">
        <div class="card-header">
          Add Train
        </div>
        <div class="card-body">
          <form>
            <div class="form-group">
              <label for="train-name">Train Name</label>
              <input type="text" class="form-control" id="input-train" placeholder="">
            </div>
            <div class="form-group">
              <label for="destination">Destinatiomn</label>
              <input type="text" class="form-control" id="input-destination" placeholder="">
            </div>
            <div class="form-group">
              <label for="train-time">First Train Time</label>
              <input type="text" class="form-control" id="train-time" placeholder="HH:mm - military tinme">
            </div>
            <div class="form-group">
              <label for="frequency">Frequency</label>
              <input type="text" class="form-control" id="input-frequency" placeholder="(min)">
            </div>
            <button type="submit" id="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
      </div>
    </div>
    <div class="col-sm-2"></div>
  </div>
  <script>

     // Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAAAPRsS6JnfsWK-Fhz4ioHxP5zRNIvBfQ",
    authDomain: "alexei-930cb.firebaseapp.com",
    databaseURL: "https://alexei-930cb.firebaseio.com",
    projectId: "alexei-930cb",
    storageBucket: "",
    messagingSenderId: "856201311867",
    appId: "1:856201311867:web:0c4f145a7cf5526f6854de"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

    
    var dataRef = firebase.database();

      // Initial Values
      $("#input-train").val(" ");
      $("#input-destination").val(" ");
      $("#train-time").val(" ");
      $("#input-frequency").val(" ");

    



    //declare variables that will hold the imput of each rext field
    $("#submit").on("click", function (event) {
      event.preventDefault();
      var inputTrain = $("#input-train").val();
      console.log(inputTrain)
      var inputDestination = $("#input-destination").val();
      console.log(inputDestination)
      var firstTrain = $("#train-time").val();
      console.log(firstTrain)
      var inputFrequency = $("#input-frequency").val();
      console.log(inputFrequency)

// Code for the push
 dataRef.ref().push({
      inputTrain: inputTrain,
      inputDestination: inputDestination,
      firstTrain: firstTrain,
      inputFrequency: inputFrequency,
      // firstTimeConverted: firstTimeConverted,
      
      
      });

    });

    // Firebase watcher + initial loader HINT: .on("value")
    dataRef.ref().on("child_added", function(snapshot) {
      // Log everything that's coming out of snapshot
      console.log(snapshot.val());
      console.log(snapshot.val().inputTrain);
      console.log(snapshot.val().inputDestination);
      console.log(snapshot.val().firstTrain);
      console.log(snapshot.val().inputFrequency);

      var inputDestination = snapshot.val().inputDestination
      var inputTrain = snapshot.val().inputTrain
      var firstTrain = snapshot.val().firstTrain
      var inputFrequency = snapshot.val().inputFrequency
      // First Time (pushed back 1 year to make sure it comes before current time)
    var firstTimeConverted = moment(firstTrain, "HH:mm").subtract(1, "years");
    console.log(firstTimeConverted);

    // Current Time
    var currentTime = moment();
    var currentTime =("CURRENT TIME: " + moment(currentTime).format('MMMM Do YYYY, h:mm:ss a'));

    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
    console.log("DIFFERENCE IN TIME: " + diffTime);

    // Time apart (remainder)
    var tRemainder = diffTime % inputFrequency;
    // console.log("time remainder" + " " + tRemainder);

    // Minute Until Train
    var tMinutesTillTrain = inputFrequency - tRemainder;
    console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);

    // Next Train
    var nextTrain = moment().add(tMinutesTillTrain, "minutes");
    var nextTrain = (moment(nextTrain).format("hh:mm"));
    
     // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text(inputTrain),
    $("<td>").text(inputDestination),
    $("<td>").text(inputFrequency),
    $("<td>").text(nextTrain),
    $("<td>").text(tMinutesTillTrain),
    
  );
  // var m = moment();
  // Append the new row to the table
  $("#employee-table > tbody").append(newRow);
  $("#current-time").html("<h2>" + " " + currentTime + " " + "</h2>");
  });
  


    


  </script>
  <script src="javascript/app.js"></script>


  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->

</body>

</html>