<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
   
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Firebase References -->
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
    <!-- Link to Moment.js should go here -->
  <script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>

    <title>Train Scheduler</title>
</head>

<body>
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">
            <div class="jumbotron jumbotron-fluid">
                <div class="container text-center">
                    <h1 class="display-4">Anytime is a Train Time</h1>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">
            <div class="card">
                <div class="card-header">
                    Current Train Schedulle
                    
                </div>
                <div class="card-body">
                        <table class="table table-sm table-hover" id='employee-table'>
                                <thead>
                                  <tr>
                                    <th scope="col">Train Name</th>
                                    <th scope="col">Destination</th>
                                    <th scope="col">Frequency (min)</th>
                                    <th scope="col">Next Arrival</th>
                                    <th scope="col">Minutes Away</th>
                                  </tr>
                                </thead>
                                <tbody>
                                </tbody>
                              </table>
                  
                </div>
            </div>
        </div>
        <div class="col-sm-2"></div>
    </div>
    <br>
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-8">
            <div class="card">
                <div class="card-header">
                    Add Train
                </div>
                <div class="card-body">
                    <form>
                        <div class="form-group">
                            <label for="train-name">Train Name</label>
                            <input type="text" class="form-control" id="input-train"
                                 placeholder="">
                        </div>
                        <div class="form-group">
                                <label for="destination">Destinatiomn</label>
                                <input type="text" class="form-control" id="input-destination"
                                     placeholder="">
                        </div>
                        <div class="form-group">
                                <label for="train-time">First Train Time</label>
                            <input type="text" class="form-control" id="train-time"
                                 placeholder="HH:mm - military tinme">
                            </div>
                            <div class="form-group">
                                    <label for="frequency">Frequency</label>
                                    <input type="text" class="form-control" id="input-frequency"
                                         placeholder="(min)">
                            </div>
                       <button type="submit" id="submit" class="btn btn-primary">Submit</button>
                    </form>
                   </div>
            </div>
        </div>
        <div class="col-sm-2"></div>
    </div>
    <script>
        //  Your web app's Firebase configuration
  var firebaseConfig = {
    apiKey: "AIzaSyAAAPRsS6JnfsWK-Fhz4ioHxP5zRNIvBfQ",
    authDomain: "alexei-930cb.firebaseapp.com",
    databaseURL: "https://alexei-930cb.firebaseio.com",
    projectId: "alexei-930cb",
    storageBucket: "",
    messagingSenderId: "856201311867",
    appId: "1:856201311867:web:0c4f145a7cf5526f6854de"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

    var dataRef = firebase.database();


            

            // Capture Button Click
    $("#submit").on("click", function(event) {
      event.preventDefault();

      // YOUR TASK!!!
      // Code in the logic for storing and retrieving the most recent user.
      // Don't forget to provide initial data to your Firebase database.
      trainName = $("#input-train").val().trim();
      console.log(trainName);
      destination = $("#input-destination").val().trim();
      firstTime = $("#train-time").val().trim();
      tFrequency = $("#input-frequency").val().trim();

      // Code for the push
      dataRef.ref().push({

        trainName: trainName,
        destination: destination,
        firstTime: firstTime,
        tFrequency: tFrequency,
        // dateAdded: firebase.database.ServerValue.TIMESTAMP
      });
    });

    // var count = 0;

    // Firebase watcher + initial loader HINT: This code behaves similarly to .on("value")
    dataRef.ref().on("child_added", function(childSnapshot) {
    //   count++
    //   console.log("Count: " + count);
      // Log everything that's coming out of snapshot
      console.log(childSnapshot.val().trainName);
      console.log(childSnapshot.val().destination);
      console.log(childSnapshot.val().firstTime);
      console.log(childSnapshot.val().tFrequency);
    //   console.log(childSnapshot.val().comment);
    //   console.log(childSnapshot.val().dateAdded);

    //   // full list of items to the well
    //   $("#full-member-list").append("<div class='well'><span class='member-name'> " +
    //     childSnapshot.val().name +
    //     " </span><span class='member-email'> " + childSnapshot.val().email +
    //     " </span><span class='member-age'> " + childSnapshot.val().age +
    //     " </span><span class='member-comment'> " + childSnapshot.val().comment +
    //     " </span></div>");

      // Handle the errors
    }, function(errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });

    // dataRef.ref().orderByChild("dateAdded").limitToLast(1).on("child_added", function(snapshot) {
    //   // Change the HTML to reflect
    //   $("#name-display").text(snapshot.val().trainName);
    //   $("#email-display").text(snapshot.val().destination);
    //   $("#age-display").text(snapshot.val().firstTime);
    //   $("#comment-display").text(snapshot.val().tFrequency);
    // });

             // Initial Values
    // var trainName = "";
    // var destination = "";
    // var firstTime = 0;
    // var tFrequency = "";

        
            // // Assumptions
            var tFrequency = 3;
        
            // // Time is 3:30 AM
            var firstTime = "03:30";
        
            // First Time (pushed back 1 year to make sure it comes before current time)
            var firstTimeConverted = moment(firstTime, "HH:mm").subtract(1, "years");
            console.log(firstTimeConverted);
        
            // Current Time
            var currentTime = moment();
            console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));
        
            // Difference between the times
            var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
            console.log("DIFFERENCE IN TIME: " + diffTime);
        
            // Time apart (remainder)
            var tRemainder = diffTime % tFrequency;
            console.log(tRemainder);
        
            // Minute Until Train
            var tMinutesTillTrain = tFrequency - tRemainder;
            console.log("MINUTES TILL TRAIN: " + tMinutesTillTrain);
        
            // Next Train
            var nextTrain = moment().add(tMinutesTillTrain, "minutes");
            console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));

             // Create the new row
  var newRow = $("<tr>").append(
    $("<td>").text(trainName),
    $("<td>").text(destination),
    $("<td>").text(tFrequency),
    $("<td>").text(nextTrain),
    $("<td>").text(tMinutesTillTrain),
    
  );

  // Append the new row to the table
  $("#employee-table > tbody").append(newRow);

          </script>







    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
   
</body>

</html>